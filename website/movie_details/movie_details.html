<!DOCTYPE html>
<html lang="en">

<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/movie_details/movie_details.css">
    <link rel="icon" href="/assests/netflix.ico">
    <title>Movie Details</title>
</head>

<body>
    <!-- Header section -->
    <header class="header">
    <img src="/assests/netflix.png" alt="logo" class="logo">
    </header>

    <!-- Movie details section -->
    <div class="movie-details">

        <!-- Movie poster section -->

       <div class="movie-poster">
  <img id="moviePoster" src="" alt="Movie Poster">
  <iframe id="iframe" frameborder="0" allowfullscreen 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"></iframe>
</div>
        
        <!-- Movie information section -->
        <div class="movie-info">

            <h1 id="movieTitle"></h1>
            <p id="plot"></p>

            <div class="movie-data">
                <div class="design">
                    <span>Released :</span>
                    <p id="movieYear"></p>
                </div>

                <div class="design">
                    <span>Language :</span>
                    <p id="language"></p>
                </div>
            </div>

            <div class="movie-data rating-data">
                <div class="design">
                    <span>Rating :</span>
                    <p id="rating"></p>
                </div>
                <div class="design">
                    <span>Genre :</span>
                    <p id="genre"></p>
                </div>
            </div>

          <!-- Season selector dropdown -->
<div id="season-selector" class="season-selector-dropdown">
    <label for="season">Select Season:</label>
    <select id="season" class="season-selector-select">
        <!-- Seasons will be dynamically loaded here -->
    </select>
</div>

<!-- Episode list -->
<div id="episode-list">
    <!-- Episodes will be dynamically displayed here -->
</div>
      <ul id="episode-list"></ul>
<iframe id="episode-video" style="display:none; width: 100%; height: 400px;" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"></iframe>

<script>
    // Assume `tvId` and `seasonNumber` are already set
    async function loadEpisodes(seasonNumber) {
        const response = await fetch(`https://api.themoviedb.org/3/tv/${tvId}/season/${seasonNumber}?api_key=${api_Key}`);
        const data = await response.json();

        console.log("Episodes for Season:", data);  // Log episode data for debugging

        const episodeList = document.getElementById('episode-list');  // Assuming a <ul> or <div> with id="episode-list"

        // Clear previous episodes
        episodeList.innerHTML = '';

        if (data.episodes && data.episodes.length > 0) {
            data.episodes.forEach(episode => {
                const episodeItem = document.createElement('li');

                // Create a button or clickable link for each episode
                const episodeButton = document.createElement('button');
                episodeButton.classList.add('episode-button');
                episodeButton.textContent = `Episode ${episode.episode_number}: ${episode.name}`;
                episodeButton.setAttribute('data-episode-id', episode.id);  // Store episode ID for later use

                // Add event listener to handle episode selection
                episodeButton.addEventListener('click', () => {
                    loadEpisodeVideo(episode.id);  // Load the video for the selected episode
                });

                episodeItem.appendChild(episodeButton);
                episodeList.appendChild(episodeItem);
            });
        } else {
            const noEpisodesMessage = document.createElement('li');
            noEpisodesMessage.textContent = 'No episodes available for this season.';
            episodeList.appendChild(noEpisodesMessage);
        }
    }

    async function loadEpisodeVideo(episodeId) {
        // Fetch video data for the selected episode
        const response = await fetch(`https://api.themoviedb.org/3/tv/${tvId}/episode/${episodeId}/videos?api_key=${api_Key}`);
        const data = await response.json();

        console.log("Episode video data:", data);  // Log the video data for debugging

        // Check if the video data is available
        if (data.results && data.results.length > 0) {
            const video = data.results[0];  // Assuming the first result is the correct one (e.g., a trailer or video link)
            
            const videoUrl = `https://www.youtube.com/embed/${video.key}`;  // YouTube embedded video URL
            const iframe = document.getElementById('episode-video');  // Assuming you have an iframe with id="episode-video"
            
            // Update iframe with the video URL
            iframe.src = videoUrl;
            iframe.style.display = "block";  // Ensure iframe is visible
        } else {
            alert("No video available for this episode.");
        }
    }
</script>

            <!-- watchList button section -->
            <button class="watchListBtn"></button>
            <!-- Change server dropdown -->
<button id="change-server-btn" class="change-server-btn"><b>CHANGE SERVER</b></button>
 
 <!-- Server selector dropdown -->
             <!-- Change server dropdown -->
 <div id="server-selector" class="server-selector-dropdown">
   <label for="server">Select Server:</label>
   <select id="server" class="server-selector-select">
     <option value="player.videasy.net">Player.Videasy.net</option>
     <option value="vidsrc.cc">Vidsrc.cc</option>
     <option value="vidsrc.me">Vidsrc.me</option>
     <option value="2embed">2Embed</option>
   </select>
</div>

    <script src="/movie_details/movie_details.js"></script>
</body>

</html>
